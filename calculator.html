<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>体彩赔率计算器</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
</head>
<style>
    input{
        color: red;
    }
    .flex{
        display: flex;
        flex-direction: column;
    }
    .w{
        width: 81px;
    }
    table{
        width: 288px;
    }
    td>input{
        width: 26px;
    }
    .opendd>input{
        width: 30px;
    }
    .wire{
        width: 300px;
        height: 1px;
        background-color: red;
        margin-top: 5px;
    }
    .le{
        margin-left: 10px;
    }
    .le1{
        margin-left: 27px;
    }
    .re{
        position: relative;
        top: 21px;
        display: inline-block;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 1px solid black;
        line-height: 20px;
        text-align: center;
        color: red;
    }
    .red{
        color: red;
    }
</style>
<body>
    <div class="flex">
        <table class="bunchAll">
            <tr class="bunch-0">
                <td>队名</td>
                <td colspan="8"><input type="text" class="Tname0" style="width: 200px;"></td>
            
            </tr>
            <tr>
                <td>0球</td>
                <td>1球</td>
                <td>2球</td>
                <td>3球</td>
                <td>4球</td>
                <td>5球</td>
                <td>6球</td>
                <td>7球</td>
            </tr>
            <tr>
                <td><input type="text" class="zero-0" placeholder="" attr=0></td>
                <td><input type="text" class="one-0" placeholder="" attr=1></td>
                <td><input type="text" class="two-0" placeholder="" attr=2></td>
                <td><input type="text" class="three-0" placeholder="" attr=3></td>
                <td><input type="text" class="four-0" placeholder="" attr=4></td>
                <td><input type="text" class="five-0" placeholder="" attr=5></td>
                <td><input type="text" class="six-0" placeholder="" attr=6></td>
                <td><input type="text" class="seven-0" placeholder="" attr=7></td>
            </tr>
        </table>
        <div>
            <span>投入金额</span><input type="text" class="betsum">
        </div>
        <div>
            <input type="button" style="color: black;" value="确认" class="affirm">
            <input type="button" class="add" value="+" style="color: black;width: 42px;">
            <input type="button" class="sub" value="-" style="color: black;width: 42px;">
        </div>
        <div class="flex">
            <div class="opendd">
            </div>
        </div>
        
    </div>
</body>
</html>

<script>
    let affirm = $('.affirm')
    let e = []
    let bunchId = 1
    $(".add").click(function(){
        $(".bunchAll").append(`
            <tbody>
                <tr class="bunch-${bunchId}">
                    <td>队名</td>
                    <td colspan="8"><input type="text" class="Tname${bunchId}" style="width: 200px;"></td>
                
                </tr>
                <tr>
                    <td>0球</td>
                    <td>1球</td>
                    <td>2球</td>
                    <td>3球</td>
                    <td>4球</td>
                    <td>5球</td>
                    <td>6球</td>
                    <td>7球</td>
                </tr>
                <tr>
                    <td><input type="text" class="zero-${bunchId}" placeholder="" attr=0></td>
                    <td><input type="text" class="one-${bunchId}" placeholder="" attr=1></td>
                    <td><input type="text" class="two-${bunchId}" placeholder="" attr=2></td>
                    <td><input type="text" class="three-${bunchId}" placeholder="" attr=3></td>
                    <td><input type="text" class="four-${bunchId}" placeholder="" attr=4></td>
                    <td><input type="text" class="five-${bunchId}" placeholder="" attr=5></td>
                    <td><input type="text" class="six-${bunchId}" placeholder="" attr=6></td>
                    <td><input type="text" class="seven-${bunchId}" placeholder="" attr=7></td>
                </tr>    
            </tbody>
        `)
        bunchId++
    })
    $(".sub").click(function(){
        if(bunchId > 1){
            let children = $('.bunchAll').children();
            children.eq(bunchId-1).remove();
            bunchId--
        }
    })
    affirm.click(function(){
        let betAmount = $('.betsum')[0].value
        //每球的赔率
        for(let i =0;i<bunchId;i++){
            let zeroName = `zeroV${i}`
            window[zeroName] = $(`.zero-${i}`)[0]
            let oneName = `oneV${i}`
            window[oneName] = $(`.one-${i}`)[0]
            let twoName = `twoV${i}`
            window[twoName] = $(`.two-${i}`)[0]
            let threeName = `threeV${i}`
            window[threeName] = $(`.three-${i}`)[0]
            let fourName = `fourV${i}`
            window[fourName] = $(`.four-${i}`)[0]
            let fiveName = `fiveV${i}`
            window[fiveName] = $(`.five-${i}`)[0]
            let sixName = `sixV${i}`
            window[sixName] = $(`.six-${i}`)[0]
            let sevenName = `sevenV${i}`
            window[sevenName] = $(`.seven-${i}`)[0]

            let rateName = `rate${i+1}`
            window[rateName] = [window[zeroName],window[oneName], window[twoName], window[threeName], window[fourName], window[fiveName], window[sixName], window[sevenName]];
            window[rateName] = window[rateName].filter(item => item.value !== "")
            let TnameN = `Tname${i}`
            window[TnameN] = $(`.Tname${i}`)
        }
        // 计算所有组合的奖金
        let profits = [];
        let list = []
        for(let i=0; i<rate1.length; i++) {
            if(typeof rate2 !='undefined'){
                for(let j=0; j<rate2.length; j++) {
                    if(typeof rate3 !='undefined'){
                        for(let k=0; k<rate3.length; k++){
                            if(typeof rate4 !='undefined'){
                                for(let z=0; z<rate4.length; z++){
                                    profits.push(rate1[i].value * rate2[j].value * rate3[k].value * rate4[z].value);
                                    list.push(rate1[i].attributes.attr.value)
                                    list.push(rate2[j].attributes.attr.value)
                                    list.push(rate3[k].attributes.attr.value)
                                    list.push(rate4[z].attributes.attr.value)
                            }
                            }else{
                                profits.push(rate1[i].value * rate2[j].value * rate3[k].value); 
                                list.push(rate1[i].attributes.attr.value)
                                list.push(rate2[j].attributes.attr.value)
                                list.push(rate3[k].attributes.attr.value)
                            }
                        }
                    }else{
                        profits.push(rate1[i].value * rate2[j].value); 
                        list.push(rate1[i].attributes.attr.value)
                        list.push(rate2[j].attributes.attr.value)
                    }
                }
            }else{
                profits.push(rate1[i].value); 
                list.push(rate1[i].attributes.attr.value)
            }
        }

        let ratios = profits.map(rate => 1/rate);
        // 正规化比例之和为1  
        let totalRatio = ratios.reduce((a,b) => a+b, 0);

        ratios = ratios.map(ratio => ratio/totalRatio); 
        // console.log(ratios)
        // console.log(betAmount)
        // 计算理论投注金额(四舍五入)
        let expectedBets = ratios.map(ratio => Math.round(ratio * betAmount / 2) * 2);
        // console.log(expectedBets)
        // 调整为2的倍数
        let bets = expectedBets.map(bet => {
        let n = bet;
        while(n % 2 !== 0) {
            n--;
        }
        return n;
        });

        // 计算实际投注金额总和
        
        let actualTotal
        if(profits.length !==0){
            actualTotal = bets.reduce((a,b) => a + b);
        }
        // 如果总和小于总投注金额
        if(actualTotal < betAmount) {
        // 平均分配剩余金额
        //...
        }

        // 如果总和大于总投注金额
        if(actualTotal > betAmount) {
        // 从每个球减少少量金额
        //...
        }
        $('.opendd').empty()
        let s = 0
        let x = []
        console.log(list)
        let change = 0
        // let Tname1 = $(".Tname1")
        // let Tname2 = $(".Tname2")
        // let Tname3 = $(".Tname3")
        // let Tname4 = $(".Tname4")
        for(let i = 0;i<list.length;i++){
                $('.opendd').append(`
                    <div>
                        <div class="re">${s+1}</div>
                        ${rate1.length >= 1 ? '<span>'+Tname0.val()+'(<span class="red">'+list[i]+'</span>)球</span>' : ''}
                        ${typeof rate2 !='undefined' ? '<span>'+Tname1.val()+'(<span class="red">'+list[++i]+'</span>)球</span>' : ''}<br>
                        ${typeof rate3 !='undefined' ? '<span class="le1">'+Tname2.val()+'(<span class="red">'+list[++i]+'</span>)球</span>' : ''}
                        ${typeof rate4 !='undefined' ? '<span>'+Tname3.val()+'(<span class="red">'+list[++i]+'</span>)球</span>' : ''}
                    </div>
                    <span class="le1">倍数</span>
                    <input class="inp-${s}" type="text" value="${bets[s] / 2}">
                        
                `)
                $('.opendd').append(`
                    <span>奖金</span>
                    <span class="red bonus-${s}">${change == 0 ? $(`.inp-${s}`).val()*2*profits[s] : change*2*profits[s]}</span>
                    <span>元</span>
                    <div class="wire"></div>
                `)
            x.push(s)
            s++
        }
        let run = 0
        for(let i = 0;i<x.length;i++){
            $(`.inp-${i}`).on('blur',function(){
                change = $(`.inp-${i}`).val();
                $(`.bonus-${i}`).text(change*2*profits[i])
                console.log(x)
                for(let b = 0;b<x.length;b++){
                    console.log($(`.inp-${b}`).val())
                    // $(`.inp-${b}`).val()
                    run += parseFloat($(`.inp-${b}`).val() * 2) 
                    console.log(run)
                    $('.betsum')[0].value = run
                }
                run = 0
            })
            
        }
    })

    
</script>
